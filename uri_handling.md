
# CactusPlugin: Обработка URI

CactusLib включает мощную систему для создания и обработки кастомных URI-схем вида `tg://cactus/...`. Это позволяет создавать интерактивные кнопки в сообщениях, которые могут вызывать функции вашего плагина.

### Создание URI-ссылки

Для генерации ссылки используется статический метод `CactusUtils.Uri.create()`.

```python
CactusUtils.Uri.create(plugin, command: str, **kwargs)
```

  - `plugin`: Экземпляр вашего плагина (`self`).
  - `command`: Имя команды/действия, которое будет вызвано.
  - `**kwargs`: Любые именованные аргументы, которые вы хотите передать в обработчик.

**Пример создания ссылки в сообщении:**

```python
# Создаем URI, который вызовет обработчик 'show_alert' в текущем плагине
# и передаст ему 'user_id=123' и 'text=Hello'
my_uri = self.utils.Uri.create(
    self,
    "show_alert",
    user_id=123,
    text="Hello"
)

# Формируем HTML-разметку для кнопки
button_text = f"<a href='{my_uri}'>Нажми меня!</a>"

# Отправляем сообщение
self.answer(command.params, button_text, parse_mode="HTML")
```

### Обработка URI

Чтобы принять и обработать URI, используется декоратор `@uri`.

```python
@uri(uri: str)
def my_uri_handler(self, **kwargs): ...
```

  - `uri`: Имя команды/действия из ссылки, которое этот метод будет обрабатывать.
  - Функция-обработчик принимает переданные в URI параметры как именованные аргументы.

**Пример обработчика:**

```python
@uri("show_alert")
def handle_show_alert(self, user_id: str, text: str):
    # Аргументы (user_id, text) приходят из URI.
    # Обратите внимание, что все значения будут строками.
    self.info(f"URI 'show_alert' вызван для пользователя {user_id} с текстом: {text}")

    # Показываем системное уведомление
    self.utils.show_info(f"Привет от пользователя {user_id}!")
```

Эта система активно используется в самом CactusLib для создания интерактивного меню помощи (`.chelp`), где кнопки "включить/выключить плагин", "настройки" и "помощь" являются URI-ссылками.
